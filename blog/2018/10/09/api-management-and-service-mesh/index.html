<!DOCTYPE html>
<html lang="zh">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>API管理和服务网格——为什么说服务网格无法替代API管理 · ljziyue的个人空间</title>
  <meta name="author" content="" />

  
  <meta name="keywords" content="ljziyue, 子曰">	
  

  
  <meta name="description" content="Site made by ljziyue using hugo">	
  

  <meta name="generator" content="Hugo 0.53" />


  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1000118_rr5nfb86qua.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.default.css" rel="stylesheet" id="theme-stylesheet">
  


  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
  

  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="https://ljziyue.github.io/index.xml" type="application/rss+xml" title="子曰">

  
  <meta property="og:title" content="API管理和服务网格——为什么说服务网格无法替代API管理" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/blog/2018/10/09/api-management-and-service-mesh//" />
  <meta property="og:image" content="img/logo.png" />

</head>


  <body>

    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="https://ljziyue.github.io/">
                    <img src="https://ljziyue.github.io/img/logo.png" alt="API管理和服务网格——为什么说服务网格无法替代API管理 logo" class="hidden-xs hidden-sm">
                    <img src="https://ljziyue.github.io/img/logo-small.png" alt="API管理和服务网格——为什么说服务网格无法替代API管理 logo" class="visible-xs visible-sm">
                    <span class="sr-only">API管理和服务网格——为什么说服务网格无法替代API管理 - 转到主页</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">切换导航</span>
                        <i class="iconfont icon-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <li class="dropdown">
                    
                    <a href="/">主页</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/blog/">博客</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">联系我们</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="iconfont icon-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>API管理和服务网格——为什么说服务网格无法替代API管理</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">
						<i class="iconfont icon-bookeps">
                        2018年10月09日
                        </i>
                        |
                        
						<i class="iconfont icon-author">
						<a href="https://itnext.io/@jmprusi?source=post_header_lockup">Joaquim Moreno</a>
						</i>
						|
                        
						
						<i class="iconfont icon-link">
                        <a href="https://itnext.io/api-management-and-service-mesh-e7f0e686090e">查看原文</a>
						</i>
                        |
                        
                        
                        
                        
                        <i class="iconfont icon-category">
						<a href="https://ljziyue.github.io/categories/translation">translation</a>
						</i>
                        
						|
                        
                        
                        
                        
						<i class="iconfont icon-tags">
                        
                        <a href="https://ljziyue.github.io/tags/service-mesh/">#service mesh</a>&nbsp;
						</i>
                        
                        <a href="https://ljziyue.github.io/tags/api-management/">#API Management</a>&nbsp;
						</i>
                        
                        
                        </p>

                        <div id="post-content">
                          

<h1 id="api管理和服务网格-为什么说服务网格无法替代api管理">API管理和服务网格——为什么说服务网格无法替代API管理</h1>

<p>首先声明，我在RedHat工作，确切得说，是在3scale团队开发3scale API管理解决方案。最近，在跟我们的客户讨论时有个问题被越来越多的提及：<code>使用了Istio之后，为什么还需要API管理？</code></p>

<p>为了回答这个问题，我们首先要搞明白服务网格和API管理究竟是什么，剧透一下：3scale API Management和Istio可以共存。</p>

<p>让我们聚焦于3scale API Management和Istio Service Mesh（这两者是我比较了解的），我会尽量描述清楚这两个方案的目标是解决哪些问题。</p>

<h2 id="api-management解决方案是什么">API Management解决方案是什么？</h2>

<p>我们先看一下Wikipedia的定义：<code>API管理的过程包括创建和发布Web API、执行调用策略、访问控制、订阅管理、收集和分析调用统计以及报告性能。</code></p>

<p>这是一个清晰的定义。作为一家已经创建了一系列内部Service的公司，我现在希望通过向外部订阅者提供API的方式构建业务。当然，我会通过提供一些订阅计划来量化它，包括使用限制、范围，并且可以自动的给客户提供账单。</p>

<p>此外，外部开发者可以很容易地发现我提供的API，并使用他们的信用卡以自服务的方式注册订阅计划，而这一切，对我的API代码来说应该是透明的。</p>

<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fvpbzdautwj30m80cp412.jpg" alt="API Management Platform" /></p>

<p>分析过这些需求之后，我们可以把它们归为以下几类：</p>

<ul>
<li>访问控制和安全：控制谁可以访问我的API，以及以何种方式访问。</li>
<li>API契约和流量限制：一位用户在一次订阅的情况下可以调用多少次请求。</li>
<li>分析和报告：API运行情况怎么样？哪些方法被调用的最为频繁？有没有错误？API调用的趋势是什么？</li>
<li>开发者门户，文档：让开发者发现你的API并注册订阅计划。</li>
<li>账单：提供发票并向开发者收取费用。</li>
</ul>

<p>API管理方案是如何做到这些的？这要得益于一个叫做API Gateway的组件。</p>

<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fvpc2rrv5xj30lq097t90.jpg" alt="API Gateway" /></p>

<p>这是一个位于调用流程中间环节的组件，所有客户端请求都会经过它，它能够保护你的API端点，并通过与其他API Management组件通信来决定是否让一个用户访问的你的API。</p>

<p>它一般是通过对用户请求进行身份识别和流量控制来实现的。考虑下面这个场景：</p>

<ul>
<li>用户A订阅了<code>Basic Plan</code>。</li>
<li><code>Basic Plan</code>定义了一些API操作（HTTP Method + HTTP path）的限制，例如：<code>Get /products</code>和<code>POST /shipments</code>。</li>
<li>这些限制可以被定义成每秒/分钟/月等等。</li>
<li><code>GET /Products</code>可以被限制成每分钟请求10次。</li>
</ul>

<p>在这种情况下，当用户A想在1分钟内调用10次以上时，超出的请求就会因为流量控制而收到429状态码。或者身份验证没有通过，用户就会收到403（Forbidden）状态码。身份识别可以通过Oauth、请求参数或者header来提供。</p>

<p>流量控制是API Management的关键部分。这也是API Gateway针对最终用户执行业务规则的部分，流量控制可以实现非常复杂的场景，比如基于多条规则或客户端IP。API Management之所以强大，在于它可以满足复杂流量控制场景（业务规则）的能力。</p>

<p>因此，我可以大声地说：<code>API Management 不（仅仅）是流量限制。</code></p>

<h2 id="service-mesh是什么">Service Mesh是什么？</h2>

<p>前面我们讲了API，却没有提及Service、Application、Port、Connection、Retry等等，因为在API Management层，我们不需要关心这些。但是现在我们需要了。</p>

<p>API的背后是什么？多个互相通信的Service，它们之间的交互组成了一个完整的API，每个Service可能由不同的编程语言实现，并且由同一个庞大组织内的不同地区的不同团队进行维护和操作。这听起来耳熟吗？对，微服务！</p>

<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fvpc2uooboj30lo0f1wek.jpg" alt="Microservice or connected dots" /></p>

<p>一个完整的API，由多个Service共同完成，这听起来很棒，但是随着越来越多的团队为新特性或新需求发布新的Service，日渐增长的架构运维复杂度问题就会暴露出来：</p>

<ul>
<li>如果Service之间的内部调用失败了会发生什么？</li>
<li>请求失败发生在哪里？</li>
<li>为什么这个API端点这么慢？哪个Service有问题？</li>
<li>这个Service真的容易出错，我们可以在出错的时候重试吗？</li>
<li>某人总是在每天的同一时刻大量请求这个Service，我们需要通过流量限制避免它。</li>
<li>这个Service不可以访问到另一个Service&hellip;&hellip;</li>
</ul>

<p>这些问题可以由Service Mesh解决，并归为以下类别：</p>

<ul>
<li>弹性：超时、重试、熔断、故障处理、负载均衡。</li>
<li>流量限制：基于多个来源的基础设施流量限制。</li>
<li>通信路由：根据path、host、header、cookie base、源Service&hellip;&hellip;</li>
<li>可观测性：指标、日志、分布式追踪。</li>
<li>安全：mTLS、RBAC&hellip;&hellip;</li>
</ul>

<p>所有这些都是以对Application透明的方式执行的。</p>

<p>我们来看一下Istio是如何工作的：</p>

<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fvpc361862j30dc0ao74r.jpg" alt="Istio Components diagram" /></p>

<p>Istio使用<code>sidecar 容器</code>模式，通过在同一个Pod中运行一个新增的容器实例来扩展核心容器的功能。这个核心容器就是我们的Application，而Sidecar容器，是Istio基于Envoy的代理。</p>

<p>如上图所示，注入之后，所有的出入Application容器的通信，都将被这个代理劫持（使用IPTables）。</p>

<p>通过这种方式，Istio就能控制通信，以及向控制平面报告发生了什么。确切来说，是报告给作为遥测和策略引擎的Mixer。</p>

<h2 id="它们之间的共同点是什么">它们之间的共同点是什么？</h2>

<p>我们已经明确了这两种技术，你发现了什么共同点？它们试图解决不同的问题，但是使用的是相同的技术&hellip;&hellip;</p>

<p>这两个方案有一点共同之处：</p>

<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fvpc37snftj30xc0lwwhf.jpg" alt="common thing" /></p>

<p>但是记住这一点很重要，它们的流量限制分别用来处理不同的事务：业务规则和基础设施之间的限制。</p>

<p>因此，它们并不是互斥的，我们应该把它们当做基础设施的不同层面：</p>

<ol>
<li>API Management：处理对API的访问，基于开发者、订阅计划、Application、账单等等。</li>
<li>Service Mesh：让你的API变得更安全，便于监控，以及弹性能力。</li>
</ol>

<h2 id="我们如何将3scale-api-management和istio-service-mesh结合起来">我们如何将3scale API Management和Istio Service Mesh结合起来？</h2>

<p>3scale是如何将API Management的能力添加到Istio Service Mesh的？请继续关注我们更多的技术发布，你可以使用我们的<a href="https://github.com/3scale/apicast">API Gateway APIcast</a>或者使用<a href="https://github.com/3scale/istio-integration/tree/master/3scaleAdapter">3scale Istio Adapter</a>原生地扩展Istio。</p>

                        </div>
                        
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">搜索</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="搜索">
                <input type="hidden" name="sitesearch" value="https://ljziyue.github.io/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="iconfont icon-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">分类</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="https://ljziyue.github.io/categories/markdown"><i class="iconfont icon-category"></i>markdown (1)</a>
            </li>
            
            <li><a href="https://ljziyue.github.io/categories/translation"><i class="iconfont icon-category"></i>translation (1)</a>
            </li>
            
            <li><a href="https://ljziyue.github.io/categories/%e4%bc%98%e5%8c%96"><i class="iconfont icon-category"></i>优化 (1)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">标签</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="https://ljziyue.github.io/tags/api-management"><i class="iconfont icon-tags"></i> api-management</a>
            </li>
            
            <li><a href="https://ljziyue.github.io/tags/md%e7%bc%96%e8%be%91"><i class="iconfont icon-tags"></i> md编辑</a>
            </li>
            
            <li><a href="https://ljziyue.github.io/tags/service-mesh"><i class="iconfont icon-tags"></i> service-mesh</a>
            </li>
            
            <li><a href="https://ljziyue.github.io/tags/%e7%bd%91%e7%ab%99%e7%bb%b4%e6%8a%a4"><i class="iconfont icon-tags"></i> 网站维护</a>
            </li>
            
        </ul>
    </div>
</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        <footer id="footer">
    <div class="container">

        
        <div class="col-md-4 col-sm-6">
            <h4>关于我们</h4>

            Ljziyue's personal website.<br />Graduated from China University of Geosciences.<br />Operation and Maintenance Engineer.<br />Interested in Linux and Internet.<br />Computer and digital enthusiast.<br />Zhihu-er and LOL player.

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

        <div class="col-md-4 col-sm-6">

             
            <h4>最新博客</h4>

            <div class="blog-entries">
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://ljziyue.github.io/blog/">
                          
                            <img src="https://ljziyue.github.io/img/placeholder.png" class="img-responsive" alt="博客">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://ljziyue.github.io/blog/">博客</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://ljziyue.github.io/blog/2018/12/30/modify-records/">
                          
                            <img src="https://ljziyue.github.io/img/banners/banner-5.jpg" class="img-responsive" alt="网站修改优化记录">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://ljziyue.github.io/blog/2018/12/30/modify-records/">网站修改优化记录</a></h5>
                    </div>
                </div>
                
                <div class="item same-height-row clearfix">
                    <div class="image same-height-always">
                        <a href="https://ljziyue.github.io/blog/2018/12/10/markdown/">
                          
                            <img src="https://ljziyue.github.io/img/banners/banner-3.jpg" class="img-responsive" alt="这是第一篇使用md编辑的网页,一个新的开始">
                          
                        </a>
                    </div>
                    <div class="name same-height-always">
                        <h5><a href="https://ljziyue.github.io/blog/2018/12/10/markdown/">这是第一篇使用md编辑的网页,一个新的开始</a></h5>
                    </div>
                </div>
                
            </div>

            <hr class="hidden-md hidden-lg">
             

        </div>
        

        
        <div class="col-md-4 col-sm-6">

          <h4>联系我们</h4>

            <strong>Wuhuan Engineering Co., Ltd.</strong>
        <br />1019 Minzu Road
        <br />East Lake Hi-tech Development Zone
        <br />Wuhan,Hubei
        <br />
        <strong>PR China.</strong>
      </p>
      


            <a href="/contact" class="btn btn-small btn-template-main">转到联系页面</a>

            <hr class="hidden-md hidden-lg hidden-sm">

        </div>
        
        

    </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2018, ljziyue all rights reserved.</p>
            
            <p class="pull-right">
              Template by <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
              

              Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>





    </div>
    

    <script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>
<script src="https://ljziyue.github.io/js/front.js"></script>


<script src="https://ljziyue.github.io/js/owl.carousel.min.js"></script>


  </body>
</html>
